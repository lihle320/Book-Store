<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookworm - Customer Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 90vh;
        }
        
        header {
            background: #4e54c8;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        nav ul li a:hover {
            color: #ffcc00;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            color: white;
        }
        
        .user-info span {
            margin-right: 15px;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .main-content {
            display: flex;
            flex: 1;
        }
        
        .sidebar {
            width: 250px;
            background: #f5f7ff;
            padding: 20px;
            border-right: 1px solid #e0e0e0;
        }
        
        .sidebar h3 {
            margin-bottom: 15px;
            color: #4e54c8;
            padding-bottom: 10px;
            border-bottom: 2px solid #4e54c8;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar ul li {
            margin-bottom: 10px;
        }
        
        .sidebar ul li a {
            color: #333;
            text-decoration: none;
            display: block;
            padding: 8px 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .sidebar ul li a:hover, .sidebar ul li a.active {
            background: #4e54c8;
            color: white;
        }
        
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }
        
        .auth-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
        }
        
        .auth-form h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #4e54c8;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .form-group input:focus {
            border-color: #4e54c8;
            outline: none;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: #4e54c8;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #3a3eb3;
        }
        
        .form-footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
        
        .form-footer a {
            color: #4e54c8;
            text-decoration: none;
            font-weight: 500;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .book-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
        }
        
        .book-image {
            height: 200px;
            background: #f0f2ff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #4e54c8;
            font-size: 64px;
        }
        
        .book-details {
            padding: 15px;
        }
        
        .book-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .book-author {
            color: #666;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .book-price {
            font-weight: bold;
            color: #4e54c8;
            margin-bottom: 15px;
        }
        
        .add-to-cart {
            background: #4e54c8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        
        .add-to-cart:hover {
            background: #3a3eb3;
        }
        
        .cart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-total {
            font-weight: bold;
            font-size: 18px;
            text-align: right;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #4e54c8;
        }
        
        .checkout-btn {
            background: #4e54c8;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .checkout-btn:hover {
            background: #3a3eb3;
        }
        
        .security-notice {
            background: #f0f9ff;
            border-left: 4px solid #4e54c8;
            padding: 15px;
            margin-top: 30px;
            border-radius: 4px;
        }
        
        .security-notice h3 {
            color: #4e54c8;
            margin-bottom: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        .checkout-form {
            margin-top: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .order-confirmation {
            text-align: center;
            padding: 30px;
        }
        
        .order-confirmation i {
            font-size: 64px;
            color: #4e54c8;
            margin-bottom: 20px;
        }
        
        .order-confirmation h2 {
            color: #4e54c8;
            margin-bottom: 15px;
        }
        
        .account-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
        }
        
        .order-history-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
        }
        
        .wishlist-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .settings-form {
            margin-top: 20px;
        }
        
        .home-section {
            text-align: center;
            padding: 30px;
        }
        
        .home-section h2 {
            color: #4e54c8;
            margin-bottom: 20px;
        }
        
        .home-section p {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .featured-books {
            margin-top: 40px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
            
            nav ul {
                justify-content: center;
                margin-top: 15px;
            }
            
            header {
                flex-direction: column;
                text-align: center;
            }
            
            .logo {
                margin-bottom: 15px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-book"></i>
                <span>Bookworm</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link" data-section="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-section="books">Books</a></li>
                    <li><a href="#" class="nav-link" data-section="account">My Account</a></li>
                    <li><a href="#" class="nav-link" data-section="cart">Cart (<span id="cart-count">0</span>)</a></li>
                </ul>
            </nav>
            <div class="user-info hidden" id="user-info">
                <span id="username-display">Guest</span>
                <button class="logout-btn" id="logout-btn">Logout</button>
            </div>
        </header>
        
        <div class="main-content">
            <aside class="sidebar">
                <h3>Categories</h3>
                <ul>
                    <li><a href="#" data-category="all" class="category-link active">All Books</a></li>
                    <li><a href="#" data-category="fiction" class="category-link">Fiction</a></li>
                    <li><a href="#" data-category="non-fiction" class="category-link">Non-Fiction</a></li>
                    <li><a href="#" data-category="sci-fi" class="category-link">Science Fiction</a></li>
                    <li><a href="#" data-category="biography" class="category-link">Biography</a></li>
                    <li><a href="#" data-category="self-help" class="category-link">Self-Help</a></li>
                    <li><a href="#" data-category="technology" class="category-link">Technology</a></li>
                </ul>
                
                <h3>Account</h3>
                <ul>
                    <li><a href="#" class="nav-link" data-section="login">Login</a></li>
                    <li><a href="#" class="nav-link" data-section="register">Register</a></li>
                    <li><a href="#" class="nav-link" data-section="order-history">Order History</a></li>
                    <li><a href="#" class="nav-link" data-section="wishlist">Wishlist</a></li>
                    <li><a href="#" class="nav-link" data-section="settings">Settings</a></li>
                </ul>
            </aside>
            
            <main class="content">
                <!-- Home Section -->
                <div id="home-section">
                    <div class="home-section">
                        <h2>Welcome to Bookworm</h2>
                        <p>Your one-stop destination for all your reading needs. Discover thousands of books across various genres, from bestsellers to hidden gems.</p>
                        <p>Sign up today and get <strong>10% off</strong> your first order!</p>
                        
                        <div class="featured-books">
                            <h3>Bestsellers</h3>
                            <div class="book-grid">
                                <div class="book-card">
                                    <div class="book-image">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="book-details">
                                        <div class="book-title">The Silent Patient</div>
                                        <div class="book-author">Alex Michaelides</div>
                                        <div class="book-price">R 279.99</div>
                                        <button class="add-to-cart" data-id="15" data-title="The Silent Patient" data-price="279.99">Add to Cart</button>
                                    </div>
                                </div>
                                
                                <div class="book-card">
                                    <div class="book-image">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="book-details">
                                        <div class="book-title">Where the Crawdads Sing</div>
                                        <div class="book-author">Delia Owens</div>
                                        <div class="book-price">R 249.50</div>
                                        <button class="add-to-cart" data-id="16" data-title="Where the Crawdads Sing" data-price="249.50">Add to Cart</button>
                                    </div>
                                </div>
                                
                                <div class="book-card">
                                    <div class="book-image">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="book-details">
                                        <div class="book-title">Educated</div>
                                        <div class="book-author">Tara Westover</div>
                                        <div class="book-price">R 265.75</div>
                                        <button class="add-to-cart" data-id="17" data-title="Educated" data-price="265.75">Add to Cart</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Login Section -->
                <div class="auth-container hidden" id="login-section">
                    <div class="auth-form">
                        <h2>Login to Your Account</h2>
                        <form id="loginForm">
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" placeholder="Enter your email" required>
                            </div>
                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" id="password" placeholder="Enter your password" required>
                            </div>
                            <button type="submit" class="btn">Login</button>
                        </form>
                        <div class="form-footer">
                            Don't have an account? <a href="#" class="nav-link" data-section="register">Register here</a>
                        </div>
                    </div>
                </div>
                
                <!-- Registration Section -->
                <div class="auth-container hidden" id="register-section">
                    <div class="auth-form">
                        <h2>Create an Account</h2>
                        <form id="registerForm">
                            <div class="form-group">
                                <label for="reg-name">Full Name</label>
                                <input type="text" id="reg-name" placeholder="Enter your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="reg-email">Email Address</label>
                                <input type="email" id="reg-email" placeholder="Enter your email" required>
                            </div>
                            <div class="form-group">
                                <label for="reg-password">Password</label>
                                <input type="password" id="reg-password" placeholder="Create a password" required>
                            </div>
                            <div class="form-group">
                                <label for="reg-confirm">Confirm Password</label>
                                <input type="password" id="reg-confirm" placeholder="Confirm your password" required>
                            </div>
                            <button type="submit" class="btn">Register</button>
                        </form>
                        <div class="form-footer">
                            Already have an account? <a href="#" class="nav-link" data-section="login">Login here</a>
                        </div>
                    </div>
                </div>
                
                <!-- Books Section -->
                <div class="hidden" id="books-section">
                    <h2>Our Book Collection</h2>
                    <div class="book-grid" id="book-grid-container">
                        <!-- Books will be dynamically added here -->
                    </div>
                </div>
                
                <!-- Account Section -->
                <div class="hidden" id="account-section">
                    <h2>My Account</h2>
                    <div class="account-section">
                        <h3>Account Details</h3>
                        <p><strong>Name:</strong> <span id="account-name"></span></p>
                        <p><strong>Email:</strong> <span id="account-email"></span></p>
                        <p><strong>Member since:</strong> <span id="member-since"></span></p>
                    </div>
                </div>
                
                <!-- Cart Section -->
                <div class="hidden" id="cart-section">
                    <h2>Your Shopping Cart</h2>
                    <div class="cart-container">
                        <div id="cart-items">
                            <!-- Cart items will be dynamically added here -->
                            <p id="empty-cart-message">Your cart is empty.</p>
                        </div>
                        <div class="cart-total">
                            Total: R<span id="cart-total">0.00</span>
                        </div>
                        <button class="checkout-btn" id="checkout-btn">Proceed to Checkout</button>
                    </div>
                </div>
                
                <!-- Checkout Section -->
                <div class="hidden" id="checkout-section">
                    <h2>Checkout</h2>
                    <div class="cart-container">
                        <form id="checkout-form" class="checkout-form">
                            <h3>Shipping Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="first-name">First Name</label>
                                    <input type="text" id="first-name" required>
                                </div>
                                <div class="form-group">
                                    <label for="last-name">Last Name</label>
                                    <input type="text" id="last-name" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="address">Address</label>
                                <input type="text" id="address" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" id="city" required>
                                </div>
                                <div class="form-group">
                                    <label for="zip">ZIP Code</label>
                                    <input type="text" id="zip" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="country">Country</label>
                                <input type="text" id="country" value="South Africa" required>
                            </div>
                            
                            <h3>Payment Information</h3>
                            <div class="form-group">
                                <label for="card-name">Name on Card</label>
                                <input type="text" id="card-name" required>
                            </div>
                            <div class="form-group">
                                <label for="card-number">Card Number</label>
                                <input type="text" id="card-number" placeholder="1234 5678 9012 3456" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="exp-date">Expiration Date</label>
                                    <input type="text" id="exp-date" placeholder="MM/YY" required>
                                </div>
                                <div class="form-group">
                                    <label for="cvv">CVV</label>
                                    <input type="text" id="cvv" placeholder="123" required>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn">Complete Purchase</button>
                        </form>
                    </div>
                </div>
                
                <!-- Order Confirmation Section -->
                <div class="hidden" id="confirmation-section">
                    <div class="order-confirmation">
                        <i class="fas fa-check-circle"></i>
                        <h2>Thank You for Your Order!</h2>
                        <p>Your order has been placed successfully.</p>
                        <p>Order #: <span id="order-number"></span></p>
                        <p>We've sent a confirmation email to your registered email address.</p>
                        <button class="btn" id="continue-shopping">Continue Shopping</button>
                    </div>
                </div>
                
                <!-- Order History Section -->
                <div class="hidden" id="order-history-section">
                    <h2>Order History</h2>
                    <div class="account-section">
                        <div id="order-history-container">
                            <p id="no-orders-message">You haven't placed any orders yet.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Wishlist Section -->
                <div class="hidden" id="wishlist-section">
                    <h2>Your Wishlist</h2>
                    <div class="account-section">
                        <div id="wishlist-container">
                            <p id="empty-wishlist-message">Your wishlist is empty.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Section -->
                <div class="hidden" id="settings-section">
                    <h2>Account Settings</h2>
                    <div class="account-section">
                        <form id="settings-form" class="settings-form">
                            <h3>Update Profile</h3>
                            <div class="form-group">
                                <label for="settings-name">Full Name</label>
                                <input type="text" id="settings-name" placeholder="Enter your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="settings-email">Email Address</label>
                                <input type="email" id="settings-email" placeholder="Enter your email" required>
                            </div>
                            
                            <h3>Change Password</h3>
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" placeholder="Enter current password">
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" placeholder="Enter new password">
                            </div>
                            <div class="form-group">
                                <label for="confirm-new-password">Confirm New Password</label>
                                <input type="password" id="confirm-new-password" placeholder="Confirm new password">
                            </div>
                            
                            <button type="submit" class="btn">Save Changes</button>
                        </form>
                    </div>
                </div>
                
                <div class="security-notice">
                    <h3>Security Features</h3>
                    <p>Our portal uses industry-standard security practices:</p>
                    <ul>
                        <li>Passwords are hashed and salted using bcrypt</li>
                        <li>All input is validated using RegEx patterns</li>
                        <li>All traffic is served over SSL/TLS encryption</li>
                        <li>Protection against XSS, CSRF, and SQL injection attacks</li>
                    </ul>
                </div>
            </main>
        </div>
    </div>

    <script>
        // State management
        let currentUser = null;
        let cart = [];
        let orders = [];
        let wishlist = [];
        let books = [];
        
        // DOM elements
        const sections = {
            home: document.getElementById('home-section'),
            login: document.getElementById('login-section'),
            register: document.getElementById('register-section'),
            books: document.getElementById('books-section'),
            account: document.getElementById('account-section'),
            cart: document.getElementById('cart-section'),
            checkout: document.getElementById('checkout-section'),
            confirmation: document.getElementById('confirmation-section'),
            orderHistory: document.getElementById('order-history-section'),
            wishlist: document.getElementById('wishlist-section'),
            settings: document.getElementById('settings-section')
        };
        
        // Simulated user database with hashed passwords
        const users = [
            { 
                id: 1, 
                name: "Demo User",
                email: "user@example.com", 
                // In a real application, this would be a bcrypt hash
                password: "$2b$10$simulatedhashforpassword123",
                joinDate: "2023-01-15"
            }
        ];
        
        // Generate sample books with random data
        function generateBooks() {
            const bookTitles = [
                "The Great Gatsby", "To Kill a Mockingbird", "1984", "Pride and Prejudice",
                "The Hobbit", "The Catcher in the Rye", "The Lord of the Rings", "Harry Potter and the Sorcerer's Stone",
                "The Da Vinci Code", "The Alchemist", "The Hunger Games", "The Girl with the Dragon Tattoo",
                "The Kite Runner", "The Book Thief", "The Help", "The Shining", "Brave New World",
                "The Silent Patient", "Where the Crawdads Sing", "Educated", "The Midnight Library",
                "Atomic Habits", "The Seven Husbands of Evelyn Hugo", "Project Hail Mary", "A Court of Thorns and Roses",
                "Dune", "The Name of the Wind", "The Night Circus", "The Goldfinch", "The Martian",
                "Gone Girl", "The Handmaid's Tale", "The Road", "The Stand", "The Picture of Dorian Gray",
                "Frankenstein", "Dracula", "The Count of Monte Cristo", "Crime and Punishment", "War and Peace",
                "Moby Dick", "The Odyssey", "The Iliad", "Don Quixote", "Les Misérables",
                "The Brothers Karamazov", "Anna Karenina", "Wuthering Heights", "Jane Eyre", "Great Expectations"
            ];
            
            const authors = [
                "F. Scott Fitzgerald", "Harper Lee", "George Orwell", "Jane Austen",
                "J.R.R. Tolkien", "J.D. Salinger", "J.K. Rowling", "Dan Brown",
                "Paulo Coelho", "Suzanne Collins", "Stieg Larsson", "Khaled Hosseini",
                "Markus Zusak", "Kathryn Stockett", "Stephen King", "Aldous Huxley",
                "Alex Michaelides", "Delia Owens", "Tara Westover", "Matt Haig",
                "James Clear", "Taylor Jenkins Reid", "Andy Weir", "Sarah J. Maas",
                "Frank Herbert", "Patrick Rothfuss", "Erin Morgenstern", "Donna Tartt",
                "Andy Weir", "Gillian Flynn", "Margaret Atwood", "Cormac McCarthy",
                "Stephen King", "Oscar Wilde", "Mary Shelley", "Bram Stoker",
                "Alexandre Dumas", "Fyodor Dostoevsky", "Leo Tolstoy", "Herman Melville",
                "Homer", "Homer", "Miguel de Cervantes", "Victor Hugo",
                "Fyodor Dostoevsky", "Leo Tolstoy", "Emily Brontë", "Charlotte Brontë",
                "Charles Dickens"
            ];
            
            const categories = ["fiction", "non-fiction", "sci-fi", "biography", "self-help", "technology"];
            
            books = [];
            
            for (let i = 0; i < bookTitles.length; i++) {
                const categoryIndex = Math.floor(Math.random() * categories.length);
                // Generate prices in ZAR (South African Rand) - roughly 18-20x USD prices
                const price = (Math.random() * 500 + 100).toFixed(2);
                books.push({
                    id: i + 1,
                    title: bookTitles[i],
                    author: authors[i],
                    price: price,
                    category: categories[categoryIndex]
                });
            }
        }
        
        // Input validation patterns
        const patterns = {
            email: /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/,
            password: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/,
            name: /^[a-zA-Z\s]{2,50}$/,
            card: /^\d{16}$/,
            cvv: /^\d{3,4}$/,
            exp: /^(0[1-9]|1[0-2])\/\d{2}$/
        };
        
        // Format currency as South African Rand
        function formatCurrency(amount) {
            return 'R ' + parseFloat(amount).toFixed(2);
        }
        
        // Initialize the application
        function init() {
            // Generate books
            generateBooks();
            
            // Check if user is logged in from previous session
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUIAfterLogin();
            }
            
            // Load cart from localStorage if exists
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartUI();
            }
            
            // Load wishlist from localStorage if exists
            const savedWishlist = localStorage.getItem('wishlist');
            if (savedWishlist) {
                wishlist = JSON.parse(savedWishlist);
            }
            
            // Load orders from localStorage if exists
            const savedOrders = localStorage.getItem('orders');
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
            }
            
            // Render books
            renderBooks('all');
            
            // Setup event listeners
            setupEventListeners();
            
            // Show home section by default
            showSection('home');
        }
        
        // Setup all event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });
            
            // Category links
            document.querySelectorAll('.category-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const category = this.getAttribute('data-category');
                    
                    // Update active class
                    document.querySelectorAll('.category-link').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    renderBooks(category);
                    showSection('books');
                });
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Registration form
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleRegistration();
            });
            
            // Settings form
            document.getElementById('settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleSettingsUpdate();
            });
            
            // Checkout button
            document.getElementById('checkout-btn').addEventListener('click', function() {
                if (currentUser) {
                    showSection('checkout');
                } else {
                    showSection('login');
                    alert('Please login to proceed to checkout');
                }
            });
            
            // Checkout form
            document.getElementById('checkout-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleCheckout();
            });
            
            // Continue shopping button
            document.getElementById('continue-shopping').addEventListener('click', function() {
                showSection('books');
            });
            
            // Logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                handleLogout();
            });
        }
        
        // Show specific section and hide others
        function showSection(sectionName) {
            // Hide all sections first
            Object.keys(sections).forEach(key => {
                sections[key].classList.add('hidden');
            });
            
            // Show the requested section
            if (sections[sectionName]) {
                sections[sectionName].classList.remove('hidden');
            }
            
            // Special cases
            if (sectionName === 'cart') {
                updateCartUI();
            } else if (sectionName === 'account' && currentUser) {
                updateAccountUI();
            } else if (sectionName === 'orderHistory' && currentUser) {
                updateOrderHistoryUI();
            } else if (sectionName === 'wishlist' && currentUser) {
                updateWishlistUI();
            } else if (sectionName === 'settings' && currentUser) {
                updateSettingsUI();
            } else if (sectionName === 'login' || sectionName === 'register') {
                // If user is already logged in, redirect to account
                if (currentUser) {
                    showSection('account');
                }
            } else if (!currentUser && (sectionName === 'account' || sectionName === 'orderHistory' || 
                      sectionName === 'wishlist' || sectionName === 'settings')) {
                // Redirect to login if trying to access protected pages
                showSection('login');
                alert('Please login to access this page');
            }
        }
        
        // Render books based on category
        function renderBooks(category) {
            const bookGrid = document.getElementById('book-grid-container');
            bookGrid.innerHTML = '';
            
            const filteredBooks = category === 'all' 
                ? books 
                : books.filter(book => book.category === category);
            
            if (filteredBooks.length === 0) {
                bookGrid.innerHTML = '<p>No books found in this category.</p>';
                return;
            }
            
            filteredBooks.forEach(book => {
                const bookCard = document.createElement('div');
                bookCard.className = 'book-card';
                bookCard.innerHTML = `
                    <div class="book-image">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="book-details">
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">${book.author}</div>
                        <div class="book-price">${formatCurrency(book.price)}</div>
                        <button class="add-to-cart" data-id="${book.id}" data-title="${book.title}" data-price="${book.price}">Add to Cart</button>
                        <button class="add-to-wishlist" data-id="${book.id}" style="margin-top: 8px; background: #6c757d; width: 100%; padding: 8px 15px; border: none; border-radius: 5px; color: white; cursor: pointer;">Add to Wishlist</button>
                    </div>
                `;
                bookGrid.appendChild(bookCard);
            });
            
            // Add event listeners to the new buttons
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const title = this.getAttribute('data-title');
                    const price = parseFloat(this.getAttribute('data-price'));
                    addToCart(id, title, price);
                });
            });
            
            document.querySelectorAll('.add-to-wishlist').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    addToWishlist(id);
                });
            });
        }
        
        // Handle user login
        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Input validation
            if (!patterns.email.test(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            // Find user
            const user = users.find(u => u.email === email);
            
            if (user) {
                // In a real application, we would verify the password against the hash
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUIAfterLogin();
                alert('Login successful!');
                showSection('books');
            } else {
                alert('Invalid email or password');
            }
        }
        
        // Handle user registration
        function handleRegistration() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const confirm = document.getElementById('reg-confirm').value;
            
            // Input validation
            if (!patterns.name.test(name)) {
                alert('Please enter a valid name (2-50 characters, letters and spaces only)');
                return;
            }
            
            if (!patterns.email.test(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            if (!patterns.password.test(password)) {
                alert('Password must be at least 8 characters with uppercase, lowercase, number and special character');
                return;
            }
            
            if (password !== confirm) {
                alert('Passwords do not match');
                return;
            }
            
            // Check if user already exists
            if (users.some(u => u.email === email)) {
                alert('User with this email already exists');
                return;
            }
            
            // Create new user (in a real app, this would be sent to a server)
            const newUser = {
                id: users.length + 1,
                name: name,
                email: email,
                password: password, // In a real app, this would be hashed
                joinDate: new Date().toISOString().split('T')[0]
            };
            
            users.push(newUser);
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            updateUIAfterLogin();
            
            alert('Registration successful! You are now logged in.');
            showSection('books');
        }
        
        // Handle user logout
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            
            document.getElementById('user-info').classList.add('hidden');
            document.querySelectorAll('.nav-link[data-section="login"]').forEach(el => {
                el.textContent = 'Login';
            });
            
            alert('You have been logged out');
            showSection('home');
        }
        
        // Update UI after login
        function updateUIAfterLogin() {
            if (currentUser) {
                document.getElementById('username-display').textContent = currentUser.name;
                document.getElementById('user-info').classList.remove('hidden');
                document.querySelectorAll('.nav-link[data-section="login"]').forEach(el => {
                    el.textContent = 'My Account';
                });
            }
        }
        
        // Update account UI
        function updateAccountUI() {
            if (currentUser) {
                document.getElementById('account-name').textContent = currentUser.name;
                document.getElementById('account-email').textContent = currentUser.email;
                document.getElementById('member-since').textContent = currentUser.joinDate;
            }
        }
        
        // Update order history UI
        function updateOrderHistoryUI() {
            const orderHistoryContainer = document.getElementById('order-history-container');
            orderHistoryContainer.innerHTML = '';
            
            const userOrders = orders.filter(order => order.userId === currentUser.id);
            
            if (userOrders.length === 0) {
                orderHistoryContainer.innerHTML = '<p id="no-orders-message">You haven\'t placed any orders yet.</p>';
                return;
            }
            
            userOrders.forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.className = 'order-history-item';
                orderItem.innerHTML = `
                    <h4>Order #${order.id} - ${new Date(order.date).toLocaleDateString()}</h4>
                    <p><strong>Total: ${formatCurrency(order.total)}</strong></p>
                    <p>${order.items.length} item(s)</p>
                `;
                orderHistoryContainer.appendChild(orderItem);
            });
        }
        
        // Update wishlist UI
        function updateWishlistUI() {
            const wishlistContainer = document.getElementById('wishlist-container');
            wishlistContainer.innerHTML = '';
            
            if (wishlist.length === 0) {
                wishlistContainer.innerHTML = '<p id="empty-wishlist-message">Your wishlist is empty.</p>';
                return;
            }
            
            wishlist.forEach(bookId => {
                const book = books.find(b => b.id == bookId);
                if (book) {
                    const wishlistItem = document.createElement('div');
                    wishlistItem.className = 'wishlist-item';
                    wishlistItem.innerHTML = `
                        <div>
                            <h4>${book.title}</h4>
                            <p>by ${book.author}</p>
                        </div>
                        <div>
                            <p>${formatCurrency(book.price)}</p>
                            <button class="add-to-cart" data-id="${book.id}" data-title="${book.title}" data-price="${book.price}" style="margin-top: 8px;">Add to Cart</button>
                        </div>
                    `;
                    wishlistContainer.appendChild(wishlistItem);
                }
            });
            
            // Add event listeners to the new buttons
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const title = this.getAttribute('data-title');
                    const price = parseFloat(this.getAttribute('data-price'));
                    addToCart(id, title, price);
                });
            });
        }
        
        // Update settings UI
        function updateSettingsUI() {
            if (currentUser) {
                document.getElementById('settings-name').value = currentUser.name;
                document.getElementById('settings-email').value = currentUser.email;
            }
        }
        
        // Handle settings update
        function handleSettingsUpdate() {
            const name = document.getElementById('settings-name').value;
            const email = document.getElementById('settings-email').value;
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmNewPassword = document.getElementById('confirm-new-password').value;
            
            // Input validation
            if (!patterns.name.test(name)) {
                alert('Please enter a valid name (2-50 characters, letters and spaces only)');
                return;
            }
            
            if (!patterns.email.test(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            // Check if email is already taken by another user
            if (email !== currentUser.email && users.some(u => u.email === email)) {
                alert('This email is already registered to another account');
                return;
            }
            
            // Handle password change if provided
            if (currentPassword || newPassword || confirmNewPassword) {
                if (!currentPassword) {
                    alert('Please enter your current password to change it');
                    return;
                }
                
                if (!patterns.password.test(newPassword)) {
                    alert('New password must be at least 8 characters with uppercase, lowercase, number and special character');
                    return;
                }
                
                if (newPassword !== confirmNewPassword) {
                    alert('New passwords do not match');
                    return;
                }
                
                // In a real app, we would verify the current password against the hash
                // For demo purposes, we'll just update it
                currentUser.password = newPassword;
            }
            
            // Update user info
            currentUser.name = name;
            currentUser.email = email;
            
            // Update in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            // Update localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Update UI
            updateUIAfterLogin();
            updateAccountUI();
            
            alert('Settings updated successfully!');
        }
        
        // Add item to cart
        function addToCart(id, title, price) {
            if (!currentUser) {
                alert('Please login to add items to your cart');
                showSection('login');
                return;
            }
            
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: id,
                    title: title,
                    price: price,
                    quantity: 1
                });
            }
            
            // Save to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Update UI
            updateCartUI();
            
            alert(`Added "${title}" to your cart`);
        }
        
        // Add item to wishlist
        function addToWishlist(id) {
            if (!currentUser) {
                alert('Please login to add items to your wishlist');
                showSection('login');
                return;
            }
            
            if (!wishlist.includes(id)) {
                wishlist.push(id);
                localStorage.setItem('wishlist', JSON.stringify(wishlist));
                alert('Added to your wishlist!');
            } else {
                alert('This book is already in your wishlist');
            }
        }
        
        // Update cart UI
        function updateCartUI() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            const cartCount = document.getElementById('cart-count');
            
            // Clear current items
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p id="empty-cart-message">Your cart is empty.</p>';
                cartTotal.textContent = '0.00';
                cartCount.textContent = '0';
                return;
            }
            
            // Calculate total and display items
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <div>
                        <strong>${item.title}</strong>
                        <p>${formatCurrency(item.price)} x ${item.quantity}</p>
                    </div>
                    <div>${formatCurrency(itemTotal)}</div>
                `;
                
                cartItems.appendChild(itemElement);
            });
            
            cartTotal.textContent = total.toFixed(2);
            cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
        }
        
        // Handle checkout process
        function handleCheckout() {
            // Validate form inputs
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const zip = document.getElementById('zip').value;
            const country = document.getElementById('country').value;
            const cardName = document.getElementById('card-name').value;
            const cardNumber = document.getElementById('card-number').value.replace(/\s/g, '');
            const expDate = document.getElementById('exp-date').value;
            const cvv = document.getElementById('cvv').value;
            
            if (!patterns.name.test(firstName) || !patterns.name.test(lastName)) {
                alert('Please enter valid first and last names');
                return;
            }
            
            if (!patterns.card.test(cardNumber)) {
                alert('Please enter a valid 16-digit card number');
                return;
            }
            
            if (!patterns.exp.test(expDate)) {
                alert('Please enter a valid expiration date (MM/YY)');
                return;
            }
            
            if (!patterns.cvv.test(cvv)) {
                alert('Please enter a valid CVV (3 or 4 digits)');
                return;
            }
            
            // Create order
            const order = {
                id: generateOrderId(),
                userId: currentUser.id,
                date: new Date().toISOString(),
                items: [...cart],
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                shipping: {
                    firstName,
                    lastName,
                    address,
                    city,
                    zip,
                    country
                }
            };
            
            // Save order
            orders.push(order);
            localStorage.setItem('orders', JSON.stringify(orders));
            
            // Clear cart
            cart = [];
            localStorage.removeItem('cart');
            
            // Show confirmation
            document.getElementById('order-number').textContent = order.id;
            showSection('confirmation');
        }
        
        // Generate a random order ID
        function generateOrderId() {
            return 'BW' + Math.floor(100000 + Math.random() * 900000);
        }
        
        // Initialize the application
        init();
    </script>
</body>
</html>